function doGET(e,n,t,o,a){$.mobile.loading("show",{textVisible:!1,theme:"z",html:""});var r="";for(var l in t)r+="/"+t[l];$.ajax({type:"GET",url:"/"+e+"/"+n+r,dataType:"json"}).done(function(e){$.mobile.loading("hide"),broker.setConnected(),o(e)}).fail(function(e){$.mobile.loading("hide"),404===e.status?broker.setDisconnected():broker.setConnected(),e.status>=299&&a(e)})}function doPOST(e,n,t,o,a,r){"undefined"===r&&(r="application/json"),$.mobile.loading("show",{textVisible:!1,theme:"z",html:""}),$.ajax({type:"POST",url:"/"+e+"/"+n,dataType:"json",contentType:r,data:t}).done(function(e){$.mobile.loading("hide"),broker.setConnected(),o(e)}).fail(function(e){$.mobile.loading("hide"),404===e.status?broker.setDisconnected():broker.setConnected(),e.status>=299&&a(e)})}function doGETwithCache(e,n,t,o,a){broker.isConnected?doGET(e,n,t,function(a){broker.cache.storeToCache(e,n,t,a),o(a)},function(r){404===r.status?doGETwithCache(e,n,t,o,a):a(r)}):broker.cache.getFromCache(e,n,t,o,a)}function doPOSTwithQueue(e,n,t,o,a){var r={};r.controller=e,r.action=n,r.parameterObject=t,r.reconnectHandler=function(e){broker.queue.enqueue(e.controller,e.action,e.parameterObject),broker.reconnectHandler.add(function(){var n=broker.queue.dequeue(e.controller,e.action);"undefined"!==n&&doPOST(n.controller,n.action,n.parameterObject,o,a)})},broker.isConnected?doPOST(e,n,t,function(e){o(e)},function(e){404===e.status?r.reconnectHandler(r):a(e)}):(r.reconnectHandler(r),o("Die Buchung wurde in die Warteschlange eingetragen"))}var d={canvas:null,context:null,init:function(e){d.canvas=document.getElementById(e),d.context=d.canvas.getContext("2d")},setToWindowWidth:function(){if(!d.canvas)throw Exception("Init noch nicht aufgerufen!");d.canvas.width=window.innerWidth-35,d.canvas.height=10*d.canvas.width/14},getWidth:function(){if(d.canvas)return d.canvas.width;throw Exception("Init noch nicht aufgerufen!")},getHeight:function(){if(d.canvas)return d.canvas.height;throw Exception("Init noch nicht aufgerufen!")},drawMultiLineDiagramFor:function(e,n){n=!!n;var t=e[0][0],o=d.util.getMax2(e)-t,a=d.util.getMin2(e)-t,r=d.util.getAbs(a)>d.util.getAbs(o)?d.util.getAbs(a):d.util.getAbs(o),l=(d.getWidth()-10)/(e[0].length-1),i=(d.getHeight()-20)/2/r,u=0,s=["darkblue","red","orange","green","yellow","white","black","gray"];d.drawRect(0,0,d.getWidth(),d.getHeight(),a,o,t,i),d.drawLine(0,d.getHeight()/2,d.getWidth(),d.getHeight()/2);for(var h in e){var c=d.context;c.fillStyle=s[h],c.strokeStyle=s[h],c.lineWidth=0,c.beginPath(),c.moveTo(0,d.getHeight()/2),c.lineWidth=1;for(var b in e[h]){var g=(e[h][b]-t)*i;c.lineTo(u,d.getHeight()/2-g),n&&c.fillRect(u-5,d.getHeight()/2-g-5,10,10),c.stroke(),u+=l}c.stroke(),u=0}},drawLineDiagramFor:function(e){var n=e[0],t=d.util.getMax(e)-n,o=d.util.getMin(e)-n,a=d.util.getAbs(o)>d.util.getAbs(t)?d.util.getAbs(o):d.util.getAbs(t),r=(d.getWidth()-10)/(e.length-1),l=(d.getHeight()-20)/2/a,i=5;d.drawRect(0,0,d.getWidth(),d.getHeight(),o,t,n,l),d.drawLine(0,d.getHeight()/2,d.getWidth(),d.getHeight()/2);var u=d.context;u.fillStyle="darkblue",u.strokeStyle="darkblue",u.lineWidth=1,u.beginPath(),u.moveTo(0,d.getHeight()/2);for(var s in e){var h=(e[s]-n)*l;u.lineTo(i,d.getHeight()/2-h),u.fillRect(i-5,d.getHeight()/2-h-5,10,10),u.stroke(),i+=r}u.stroke()},util:{getMax:function(e){var n="null";for(var t in e){var o=e[t];"null"===n&&(n=o),1*n<1*o&&(n=o)}return n},getMax2:function(e){var n="null";for(var t in e){"null"===n&&(n=d.util.getMax(e[t]));var o=d.util.getMax(e[t]);1*n<1*o&&(n=o)}return n},getMin:function(e){var n="null";for(var t in e){var o=e[t];"null"===n&&(n=o),1*n>1*o&&(n=o)}return n},getMin2:function(e){var n="null";for(var t in e){"null"===n&&(n=d.util.getMin(e[t]));var o=d.util.getMin(e[t]);n>o&&(n=o)}return n},getAbs:function(e){return e>=0?e:-1*e}},drawRect:function(e,n,t,o,a,r,l,i){d.context?(d.context.fillStyle="#dddddd",d.context.lineStyle=3,d.context.lineWidth=.5,d.context.fillRect(e,n,t-e,o-n)):alert("Fehler: d ist nicht initialisiert")},drawLine:function(e,n,t,o){if(d.context){var a=d.context;a.strokeStyle="#666666",a.lineWidth=.5,a.beginPath(),a.lineTo(e,n),a.stroke(),a.lineTo(t,o),a.stroke(),a.fill(),a.closePath(),a.stroke()}else alert("Fehler: d ist nicht initialisiert")}};ko.bindingHandlers.jqmRefreshList={update:function(e,n){ko.utils.unwrapObservable(n()),$(e).listview("refresh")}},ko.bindingHandlers.jqmChecked={init:ko.bindingHandlers.checked.init,update:function(e,n){ko.bindingHandlers.checked.update?ko.bindingHandlers.checked.update.apply(this,arguments):ko.utils.unwrapObservable(n()),$(e).data("mobile-checkboxradio")&&$(e).checkboxradio("refresh")}};var broker={isConnected:!0,reconnectHandler:{handlers:[],add:function(e){broker.reconnectHandler.handlers.push(e)},removeAll:function(){broker.reconnectHandler.handlers=[]},call:function(e){for(var n in broker.reconnectHandler.handlers)(0,broker.reconnectHandler.handlers[n])(e);broker.reconnectHandler.removeAll()}},setConnected:function(){var e=!broker.isConnected;broker.isConnected=!0,e&&broker.reconnectHandler.call(broker)},setDisconnected:function(){broker.isConnected=!1,window.setTimeout(broker.checkConnection,3e4)},checkConnection:function(){$.get("./ping.php").done(function(){broker.setConnected()}).fail(function(e){window.setTimeout(broker.checkConnection,3e4)})},queue:{itemAddedListeners:[],itemRemovedListeners:[],addNewItemAddedListener:function(e){$.isFunction(e)&&broker.queue.itemAddedListeners.push(e)},addItemRemovedListener:function(e){$.isFunction(e)&&broker.queue.itemRemovedListeners.push(e)},list:function(e,n){return null===localStorage.getItem("#QUEUE:"+e+":"+n)?[]:JSON.parse(localStorage.getItem("#QUEUE:"+e+":"+n))},enqueue:function(e,n,t){null===localStorage.getItem("#QUEUE:"+e+":"+n)&&localStorage.setItem("#QUEUE:"+e+":"+n,"[]");var o=JSON.parse(localStorage.getItem("#QUEUE:"+e+":"+n));o.push({controller:e,action:n,parameterObject:t}),localStorage.setItem("#QUEUE:"+e+":"+n,JSON.stringify(o));for(var a in broker.queue.itemAddedListeners)broker.queue.itemAddedListeners[a]()},dequeue:function(e,n){var t=JSON.parse(localStorage.getItem("#QUEUE:"+e+":"+n)),o=(t=t.reverse()).pop();t=t.reverse(),localStorage.setItem("#QUEUE:"+e+":"+n,JSON.stringify(t));for(var a in broker.queue.itemRemovedListeners)broker.queue.itemRemovedListeners[a]();return o}},cache:{getFromCache:function(e,n,t,o,a){var r=broker.cache.getKey(e,n,t),l=JSON.parse(localStorage.getItem(r));l?o(l):a()},storeToCache:function(e,n,t,o){var a=broker.cache.getKey(e,n,t);localStorage.setItem(a,JSON.stringify(o))},getKey:function(e,n,t){var o=e+"#"+n+"#";for(var a in t)o+=a+"="+t[a]+"&";return o}}},de=de||{};de.ww=de.ww||{},de.ww.updater=de.ww.updater||{},de.ww.updater.handlers=function(){var e=this;return registerHandler=function(e,n){window.applicationCache.addEventListener(e,n)},{onCheck:function(n){e.registerHandler("checking",function(){n()})},onUpdateReady:function(n){e.registerHandler("updateready",function(){window.applicationCache.status===window.applicationCache.UPDATEREADY&&(n(),location.reload())})}}}();var util=util||{};util.intDivision=function(e,n){return e/n-e%n/n},util.formatDateAtG=function(e){return 10!=e.length?e:e.substr(8,2)+"."+e.substr(5,2)+"."+e.substr(0,4)},util.showErrorMessage=function(e,n){n?alert(n+": "+e.status+" "+e.statusText):alert("Fehler aufgetreten: "+e.status+" "+e.statusText)},util.escapeGtLt=function(e){var n=e.replace("<","&lt;");return n=n.replace(">","&gt;")},util.isiOS=function(){return!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g)};var hhb=hhb||{};hhb.i18n={general:{back:"Zurück",home:"Menü",buchhaltung:"Buchhaltung",copy:"(c) 2013-2015 by Wolfgang Wiedermann",aktiva:"Aktiva",passiva:"Passiva",aufwand:"Aufwand",ertrag:"Ertrag",saldo:"Saldo"},buchen:{aktuellste_buchungen:"Aktuellste Buchungen",buchungstext:"Buchungstext",sollkonto:"Soll-Konto",habenkonto:"Haben-Konto",betrag:"Betrag",buchungsdatum:"Buchungsdatum",verbuchen:"verbuchen",offene_posten:"Offene Posten",offenen_posten_schliessen:"Posten schließen",successful_created:"Buchung erfolgreich angelegt",error_on_create:"Fehler beim Anlegen der Buchung aufgetreten",error_on_load:"Fehler beim Laden der Buchungen aufgetreten",warteschlange:"Warteschlange"},ergebnis:{standardauswertungen:"Standard-Auswertungen",bilanz:"Bilanz",guvjahr:"Gewinn und Verlust",guvmonat:"GuV (Monat)",guvprognose:"GuV Prognose",konto:"Konto",vormonat:"Vormonat",aktuell:"Aktuell",differenz:"Differenz",vermoegen_und_kapital:"Vermögen und Kapital",aufwand_ertrag_jahr:"Aufwand und Ertrag pro Jahr",aufwand_ertrag_monat:"Aufwand und Ertrag pro Monat",gewinn_verlust:"Gewinn und Verlust",monatsvergleich:"Monatsvergleich"},konten:{konto:"Konto",anlegen:"Konto anlegen",anlegen_button:"Anlegen",aktueller_saldo:"aktueller Saldo",monatssalden:"Monatssalden",buchungen_anzeigen:"Buchungen anzeigen",konto_bearbeiten:"Konto bearbeiten",speichern_button:"Speichern",konto_nummer:"Kontonummer",konto_bezeichnung:"Bezeichnung",konto_art:"Kontenart",error_on_load:"Fehler beim Laden der Konten aufgetreten",error_on_load_entries:"Fehler beim Laden der Buchungen des Kontos aufgetreten",error_on_load_saldo:"Fehler beim Laden der Monatssalden aufgetreten",error_on_create:"Fehler beim Anlegen des Kontos aufgetreten",error_on_update:"Fehler beim Speichern des Kontos aufgetreten"},navigation:{buchen:"Buchen",konten:"Konten",auswertungen:"Auswertungen",schnellbuchungen:"Schnellbuchungen verwalten",configuration:"Konfiguration",buchung_erfassen:"Buchung erfassen",basisfunktionen:"Basisfunktionen",administration:"Administration"},schnellbuchungen:{anlegen:"Schnellbuchung anlegen",kurzbezeichnung:"Kurzbezeichnung",buchungstext:"Buchungstext",loeschen:"Löschen"},verlauf:{kontenauswahl:"Kontenauswahl",ausgewaehltekonten:"Ausgewählte Konten",anzeigen:"Anzeigen",verlaufsauswertungen:"Verlaufs-Auswertungen",verlaufsauswertung:"Verlaufsauswertung",verlaufaufwand:"Aufwand (Monate)",verlaufertrag:"Ertrag (Monate)",verlaufgewinn:"Gewinn (Monate)",verlaufintern:"Monatsinterner Verlauf",verlaufzuundabfluss:"Zu- und Abfluss",verlauffrei:"Frei kombiniert",selektionsfehler:"Das ausgewählte Konto ist nicht mit der bestehenden Selektion kompatibel",monatsinternerverlauf_title:"Monatsinterne Verlaufsauswertung",zuundabfluss_title:"Zu- und Abfluss",verlaufgewinn_title:"Verlauf: Gewinn",verlaufertrag_title:"Verlauf: Ertrag",verlaufaufwand_title:"Verlauf: Aufwand",zufluss:"Zufluss",abfluss:"Abfluss",tag:"Tag",vormonat:"Vormonat",aktuell:"Aktueller Monat"},export:{datenexport:"Datenexport",journal:"Journal exportieren",guvmonate:"GuV Monate exportieren",bilanzmonate:"Bilanz n. Monaten exportieren",sqlbackup:"Backup exportieren"},login:{submit:"Login",username:"Username",password:"Passwort"}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.Buchung=function(e){var n=this;n.buchungstext=ko.observable(""),n.buchungsnummer=ko.observable(0),n.sollkonto=ko.observable("0"),n.habenkonto=ko.observable("0"),n.betrag=ko.observable(0),n.datum=ko.observable(JSON.stringify(new Date).substring(1,11)),n.datum_de=ko.computed(function(){return util.formatDateAtG(n.datum())}),n.benutzer=ko.observable(""),n.is_offener_posten=ko.observable(!1),e&&(n.buchungstext(e.buchungstext),n.buchungsnummer(e.buchungsnummer),n.sollkonto(e.sollkonto),n.habenkonto(e.habenkonto),n.betrag(e.betrag),n.datum(e.datum),n.benutzer(e.benutzer),n.is_offener_posten(!!e.is_offener_posten)),n.closePostenShowAusbuchen=function(e){var n=hhb.model.MainModel.buchen();n.selectedOffenerPosten(e),n.selectedBuchung().buchungstext("OP Auflösung "+e.buchungsnummer()+"; "+e.buchungstext().substr(0,20)),n.selectedBuchung().sollkonto(e.habenkonto()),n.selectedBuchung().habenkonto(e.sollkonto()),n.selectedBuchung().betrag(e.betrag()),$("#offenen_posten_ausbuchen select").selectmenu(),$("#offenen_posten_ausbuchen select").selectmenu("refresh"),jQuery.mobile.changePage("#offenen_posten_ausbuchen")}},hhb.model.types.KontoBuchung=function(e){var n=this;n.buchungstext=ko.observable(""),n.buchungsnummer=ko.observable(0),n.gegenkonto=ko.observable("0"),n.betrag=ko.observable(0),n.datum=ko.observable(JSON.stringify(new Date).substring(1,11)),n.datum_de=ko.computed(function(){return util.formatDateAtG(n.datum())}),n.benutzer=ko.observable(""),n.is_offener_posten=ko.observable(0),e&&(n.buchungstext(e.buchungstext),n.buchungsnummer(e.buchungsnummer),n.gegenkonto(e.gegenkonto),n.betrag(e.betrag),n.datum(e.datum),n.benutzer(e.benutzer),n.is_offener_posten(e.is_offener_posten))},hhb.model.types.BuchungenModel=function(){var e=this;e.selectedBuchung=ko.observable(new hhb.model.types.Buchung),e.buchungen=ko.observableArray([]),e.selectedOffenerPosten=ko.observable(new hhb.model.types.Buchung),e.verbuchen=function(){doPOSTwithQueue("Booking","createBuchung",ko.toJSON(e.selectedBuchung),function(e){alert(hhb.i18n.buchen.successful_created)},function(e){util.showErrorMessage(e,hhb.i18n.buchen.error_on_create)})},e.loadAktuellsteBuchungen=function(){e.buchungen.removeAll(),doGETwithCache("Booking","getTop25",[],function(n){for(var t=0;t<n.length;t++)e.buchungen.push(new hhb.model.types.Buchung(n[t]))},function(e){util.showErrorMessage(e,hhb.i18n.buchen.error_on_load)})},e.getWarteschlange=function(){e.buchungen.removeAll(),broker.queue.list("Booking","createBuchung").forEach(function(n){e.buchungen.push(new hhb.model.types.BuchungenModel(n))})},e.getOffenePosten=function(){e.buchungen.removeAll(),doGETwithCache("Booking","getOpList",[],function(n){for(var t=0;t<n.length;t++)e.buchungen.push(new hhb.model.types.Buchung(n[t]))},function(e){util.showErrorMessage(e,hhb.i18n.buchen.error_on_load)})},e.closePosten=function(){e.buchungen.removeAll();var n=e.selectedOffenerPosten().buchungsnummer(),t=ko.toJSON({offenerposten:n,buchung:e.selectedBuchung});0!==n&&doPOSTwithQueue("Booking","closeOpAndGetList",t,function(n){for(var t=0;t<n.length;t++)e.buchungen.push(new hhb.model.types.Buchung(n[t]));jQuery.mobile.changePage("#offene_posten")},function(e){util.showErrorMessage(e,hhb.i18n.buchen.error_on_load)})}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.ConfigurationParam=function(e){var n=this;n.param_id=ko.observable(),n.param_knz=ko.observable(""),n.param_desc=ko.observable(""),n.param_value=ko.observable(""),e&&(n.param_id(e.param_id),n.param_knz(e.param_knz),n.param_desc(e.param_desc),n.param_value(e.param_value)),n.description=ko.computed(function(){return n.param_knz()+" : "+n.param_desc()})},hhb.model.types.ConfigurationModel=function(e){var n=this;n.selectedConfigurationParam=ko.observable(new hhb.model.types.ConfigurationParam),n.configuration=ko.observableArray([]),n.load=function(){doGETwithCache("Config","listConfigEntries",[],function(e){for(var t=[],o=0;o<e.length;o++)t.push(new hhb.model.types.ConfigurationParam(e[o]));n.configuration(t),$("#configuration_liste ul").listview(),$("#configuration_liste ul").listview("refresh")},function(e){util.showErrorMessage(e,"Fehler beim Laden der Konfiguration aufgetreten")})},n.updateConfigurationParam=function(){var e=n.selectedConfigurationParam();doPOST("Config","updateConfigEntry",ko.toJSON(e),function(e){alert("Parameter aktualisiert"),jQuery.mobile.changePage("#configuration_liste")},function(e){util.showErrorMessage(e,"Fehler beim Speichern der Schnellbuchung aufgetreten")})},n.open=function(e){n.selectedConfigurationParam(e),jQuery.mobile.changePage("#configuration_form")}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.ErgebnisRechnungEintrag=function(e){var n=this;n.kontonummer=ko.observable(""),n.bezeichnung=ko.observable(""),n.betrag=ko.observable("0,00"),e&&(n.kontonummer(e.kontonummer),n.bezeichnung(e.bezeichnung),n.betrag(e.betrag))},hhb.model.types.PrognoseRechnungEintrag=function(e){var n=this;n.kontonummer=ko.observable(""),n.bezeichnung=ko.observable(""),n.betrag_vormonat=ko.observable(0),n.betrag_aktuell=ko.observable(0),n.differenz=ko.observable(0),e&&(n.kontonummer(e.kontonummer),n.bezeichnung(e.bezeichnung),n.betrag_vormonat(e.betrag_vormonat),n.betrag_aktuell(e.betrag_aktuell),n.differenz(e.differenz))},hhb.model.types.ErgebnisRechnungSumme=function(e){var n=this;n.label=ko.observable(""),n.betrag=ko.observable("0,00"),e&&(n.label(e.label),n.betrag(e.betrag))},hhb.model.types.PrognoseRechnungSumme=function(e){var n=this;n.bezeichnung=ko.observable(""),n.monat=ko.observable("201501"),n.summe=ko.observable(0),e&&(n.bezeichnung(e.bezeichnung),n.monat(e.monat),n.summe(e.saldo))},hhb.model.types.ErgebnisModel=function(){var e=this,n={};e.titel=ko.observable("Ergebnisrechnung"),e.untertitel=ko.observable("Name der Ergebnisrechnung"),e.selected_monat=ko.observable("201502"),e.selected_jahr=ko.observable("2015"),e.monat_selection_visible=ko.observable(!1),e.jahr_selection_visible=ko.observable(!1),e.jahre=ko.observableArray([]),e.monate=ko.observableArray([]),e.rechnung=ko.observableArray([]),e.rechnung.push(new hhb.model.types.ErgebnisRechnungEintrag),e.summen=ko.observableArray([]),e.summen.push(new hhb.model.types.ErgebnisRechnungSumme),e.prognose=ko.observableArray([]),e.prognose.push(new hhb.model.types.PrognoseRechnungEintrag),e.prognose_summen=ko.observableArray([]),e.prognose_summen.push(new hhb.model.types.PrognoseRechnungSumme),e.onGuVUpdateMonate=function(){e.updateMonate(function(){e.guvmonat()})},e.updateMonate=function(n){doGETwithCache("Result","getMonths",[],function(t){for(var o=[],a=0;a<t.length;a++)0===a?(o.push({monat:t[a],selected:!0}),e.selected_monat(t[a])):o.push({monat:t[a],selected:!1});e.monate(o),$("#ergebnis_view select").selectmenu(),$("#ergebnis_view select").selectmenu("refresh"),n&&$.isFunction(n)&&n()},function(e){alert("Fehler aufgetreten: "+JSON.stringify(e))})},e.updateJahre=function(n){doGETwithCache("Result","getYears",[],function(t){e.jahre.removeAll();for(var o=0;o<t.length;o++)0===o?(e.jahre.push({jahr:t[o],selected:!0}),e.selected_jahr(t[o])):e.jahre.push({jahr:t[o],selected:!1});$("#ergebnis_view select").selectmenu(),$("#ergebnis_view select").selectmenu("refresh"),n&&n()},function(e){alert("Fehler aufgetreten: "+JSON.stringify(e))})},e.initialize=function(){e.updateMonate(),e.updateJahre()},e.onchange=function(){},e.bilanz=function(){e.jahr_selection_visible(!0),e.monat_selection_visible(!1),e.onchange=e.bilanz,n.loadErgebnisrechnung("getBilanz",hhb.i18n.ergebnis.bilanz,hhb.i18n.ergebnis.vermoegen_und_kapital,{year:e.selected_jahr()})},e.guvjahr=function(){e.jahr_selection_visible(!0),e.monat_selection_visible(!1),e.onchange=e.guvjahr,n.loadErgebnisrechnung("getGuV",hhb.i18n.ergebnis.guvjahr,hhb.i18n.ergebnis.aufwand_ertrag_jahr,{year:e.selected_jahr()})},e.guvmonat=function(){e.jahr_selection_visible(!1),e.monat_selection_visible(!0),e.onchange=e.guvmonat,n.loadErgebnisrechnung("getGuVMonth",hhb.i18n.ergebnis.guvjahr,hhb.i18n.ergebnis.aufwand_ertrag_monat,{id:e.selected_monat()})},e.guvprognose=function(){e.jahr_selection_visible(!1),e.monat_selection_visible(!0),e.onchange=e.guvprognose,n.loadPrognoserechnung("getGuVPrognose",hhb.i18n.ergebnis.gewinn_verlust,hhb.i18n.ergebnis.monatsvergleich,[])},n.loadErgebnisrechnung=function(n,t,o,a){"undefined"===a&&(a=[]),e.rechnung.removeAll(),e.summen.removeAll(),e.titel(t),e.untertitel(o),doGETwithCache("Result",n,a,function(n){for(var t in n.zeilen){var o=n.zeilen[t];(r=new hhb.model.types.ErgebnisRechnungEintrag).kontonummer(o.konto),r.bezeichnung(o.kontenname),r.betrag(o.saldo),e.rechnung.push(r)}for(var t in n.ergebnisse){var a="";"1"===(o=n.ergebnisse[t]).kontenart_id?a=hhb.i18n.general.aktiva:"2"===o.kontenart_id?a=hhb.i18n.general.passiva:"3"===o.kontenart_id?a=hhb.i18n.general.aufwand:"4"===o.kontenart_id?a=hhb.i18n.general.ertrag:"5"===o.kontenart_id&&(a=hhb.i18n.general.saldo);var r=new hhb.model.types.ErgebnisRechnungSumme;r.label(a),r.betrag(o.saldo),e.summen.push(r)}jQuery.mobile.changePage("#ergebnis_view")},function(e){util.showErrorMessage(e,"Fehler beim Laden der "+t+" aufgetreten")})},n.loadPrognoserechnung=function(n,t,o,a){var a=a||[];e.prognose.removeAll(),e.prognose_summen.removeAll(),e.titel(t),e.untertitel(o),doGETwithCache("Result",n,a,function(n){for(var t in n.detail){var o=n.detail[t];(a=new hhb.model.types.PrognoseRechnungEintrag).kontonummer(o.kontonummer),a.bezeichnung(o.bezeichnung),a.betrag_vormonat(o.betrag_vormonat),a.betrag_aktuell(o.betrag_aktuell),a.differenz(o.differenz),e.prognose.push(a)}for(var t in n.summen){"1"===(o=n.summen[t]).kontenart_id?o.bezeichnung=hhb.i18n.general.aktiva:"2"===o.kontenart_id?o.bezeichnung=hhb.i18n.general.passiva:"3"===o.kontenart_id?o.bezeichnung=hhb.i18n.general.aufwand:"4"===o.kontenart_id?o.bezeichnung=hhb.i18n.general.ertrag:"5"===o.kontenart_id&&(o.bezeichnung=hhb.i18n.general.saldo);var a=new hhb.model.types.PrognoseRechnungSumme(o);e.prognose_summen.push(a)}jQuery.mobile.changePage("#prognose_view")},function(e){util.showErrorMessage(e,"Fehler beim Laden der "+t+" aufgetreten")})}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.ExportModel=function(){var e=this;e.export_journal=function(){window.open("../Office/getJournal/csv","Download")},e.export_guv=function(){window.open("../Office/getGuvMonate/csv","Download")},e.export_bilanz=function(){window.open("Office/getBilanzMonate/csv","Download")},e.export_sqlbackup=function(){window.open("../Backup/getMysqlBackup","Download")}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.Konto=function(e){var n=this;n.kontonummer=ko.observable("0000"),n.bezeichnung=ko.observable(""),n.kontenart_id=ko.observable(0),n.mandant_id=ko.observable(0),n.tostring=ko.computed(function(){return n.kontonummer()+" : "+n.bezeichnung()}),e&&(n.kontonummer(e.kontonummer),n.bezeichnung(e.bezeichnung),n.kontenart_id(e.kontenart_id),n.mandant_id(e.mandant_id))},hhb.model.types.SaldenEintrag=function(e){var n=this;n.grouping=ko.observable("000000"),n.saldo=ko.observable(0),e&&(n.grouping(e.grouping),n.saldo(e.saldo))},hhb.model.types.KontenModel=function(){var e=this;e.selectedKonto=ko.observable(new hhb.model.types.Konto),e.selectedJahr=ko.observable("2016"),e.konten=ko.observableArray([]),e.konten.push(e.selectedKonto),e.aktivkonten=ko.observableArray([]),e.aktivkonten.push(e.selectedKonto),e.buchungen=ko.observableArray([]),e.buchungen.push(new hhb.model.types.KontoBuchung),e.saldo=ko.observable(""),e.salden=ko.observableArray([]),e.salden.push(new hhb.model.types.SaldenEintrag),e.selectedJahrChanged=function(){},e.refreshKonten=function(n){e.konten.removeAll(),e.aktivkonten.removeAll(),doGETwithCache("Account","getKonten",[],function(t){for(var o=0;o<t.length;o++){var a=new hhb.model.types.Konto(t[o]);e.konten.push(a),1==t[o].kontenart_id&&e.aktivkonten.push(a)}$(".konten_liste").listview(),$(".konten_liste").listview("refresh"),n&&n(e)},function(e){util.showErrorMessage(e,hhb.i18n.konten.error_on_load)})},e.openKontenMenu=function(n){e.selectedKonto(n),jQuery.mobile.changePage("#konten_menue")},e.openKontenBearbeiten=function(){jQuery.mobile.changePage("#konto_bearbeiten"),$("#konto_bearbeiten").trigger("create")},e.openBuchungen=function(){e.buchungen.removeAll(),doGETwithCache("Booking","getListByKonto",{konto:e.selectedKonto().kontonummer(),jahr:e.selectedJahr()},function(n){var t=n.list;e.saldo(n.saldo);for(var o=0;o<t.length;o++)e.buchungen.push(new hhb.model.types.KontoBuchung(t[o]));e.selectedJahrChanged=e.openBuchungen,jQuery.mobile.changePage("#konto_buchungen")},function(e){util.showErrorMessage(e,hhb.i18n.konten.error_on_load_entries)})},e.openMonatssalden=function(){e.salden.removeAll(),doGETwithCache("Progress","getMonatsSalden",{id:e.selectedKonto().kontonummer()},function(n){for(var t=[],o=0;o<n.length;o++)e.salden.push(new hhb.model.types.SaldenEintrag(n[o])),t.push(n[o].saldo);d.init("konto_monatssalden_grafik"),d.setToWindowWidth(),d.drawLineDiagramFor(t),jQuery.mobile.changePage("#konto_monatssalden")},function(e){util.showErrorMessage(e,hhb.i18n.konten.error_on_load_saldo)})},e.anlegen=function(){doPOST("Account","createKonto",ko.toJSON(e.selectedKonto()),function(e){alert("Das Konto wurde angelegt")},function(e){util.showErrorMessage(e,hhb.i18n.konten.error_on_create)})},e.speichern=function(){doPOST("Account","saveKonto",ko.toJSON(e.selectedKonto()),function(e){alert("Die Änderungen wurden gespeichert")},function(e){util.showErrorMessage(e,hhb.i18n.konten.error_on_update)})},e.refreshKonten()},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.Kontenart=function(e){var n=this;n.kontenart_id=ko.observable(0),n.bezeichnung=ko.observable(""),e&&(n.kontenart_id(e.kontenart_id),n.bezeichnung(e.bezeichnung))},hhb.model.types.Kontenart.load=function(e){doGET("Account","getKontenArten",[],function(n){for(var t=0;t<n.length;t++)e.push(new hhb.model.types.Kontenart(n[t]))},function(e){util.showErrorMessage(e,"Fehler beim Laden der Kontenarten aufgetreten")})},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.LoginModel=function(){var e=this;e.username=ko.observable(),e.password=ko.observable(),e.authenticate=function(){JSON.parse(ko.toJSON(e));doPOST("Auth","loginAction",JSON.parse(ko.toJSON(e)),function(e){location.reload()},function(e){util.showErrorMessage(e,"Fehler")},"application/x-www-form-urlencoded")}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.NavigationEntry=function(e){var n=this;n.label=ko.observable(e.label),n.target=ko.observable(e.target),n.callback=e.callback,e.data&&(n.data=e.data)},hhb.model.types.NavigationModel=function(){var e=this;e.basisfunktionen=ko.observableArray([]),e.basisfunktionen.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.buchen,target:"#buchen_menue",callback:function(e){console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.basisfunktionen.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.konten,target:"#konten_liste",callback:function(e){hhb.model.MainModel.konten().refreshKonten(),console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.basisfunktionen.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.auswertungen,target:"#ergebnis_menue",callback:function(e){console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.administration=ko.observableArray([]),e.administration.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.schnellbuchungen,target:"#schnellbuchungen_liste",callback:function(e){console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.administration.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.configuration,target:"#configuration_liste",callback:function(e){hhb.model.MainModel.configuration().load(),console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.buchungsmenue=ko.observableArray([]),e.buchungsmenue.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.navigation.buchung_erfassen,target:"#buchungen_erfassen",callback:function(e){hhb.model.MainModel.konten().refreshKonten(),console.log(e.label()),jQuery.mobile.changePage(e.target()),$("#b_sollkonto").selectmenu(),$("#b_habenkonto").selectmenu(),$("#b_sollkonto").selectmenu("refresh",!0),$("#b_habenkonto").selectmenu("refresh",!0)}})),e.buchungsmenue.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.buchen.aktuellste_buchungen,target:"#aktuellste_buchungen",callback:function(e){hhb.model.MainModel.buchen().loadAktuellsteBuchungen(),console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.buchungsmenue.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.buchen.offene_posten,target:"#offene_posten",callback:function(e){hhb.model.MainModel.buchen().getOffenePosten(),console.log(e.label()),jQuery.mobile.changePage(e.target())}})),e.buchungsmenue.push(new hhb.model.types.NavigationEntry({label:hhb.i18n.buchen.warteschlange,target:"#buchungen_warteschlange",callback:function(e){hhb.model.MainModel.buchen().getWarteschlange(),console.log(e.label()),jQuery.mobile.changePage(e.target())}}))},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.Schnellbuchung=function(e){var n=this;n.config_id=ko.observable(0),n.config_knz=ko.observable(""),n.buchungstext=ko.observable(""),n.sollkonto=ko.observable("0000"),n.habenkonto=ko.observable("0000"),n.betrag=ko.observable(0),n.mandant_id=ko.observable(0),e&&(n.config_id(e.config_id),n.config_knz(e.config_knz),n.buchungstext(e.buchungstext),n.sollkonto(e.sollkonto),n.habenkonto(e.habenkonto),n.betrag(e.betrag),n.mandant_id(e.mandant_id))},hhb.model.types.SchnellbuchungModel=function(){var e=this;e.schnellbuchungen=ko.observableArray([]),e.schnellbuchungen.push(new hhb.model.types.Schnellbuchung),e.schnellbuchungen_navigation=ko.observableArray([]),e.selectedSchnellbuchung=ko.observable(new hhb.model.types.NavigationEntry({label:""})),e.executeSchnellbuchung=function(e){var n=hhb.model.MainModel.buchen().selectedBuchung();n.buchungstext(e.buchungstext()),n.sollkonto(e.sollkonto()),n.habenkonto(e.habenkonto()),n.betrag(e.betrag()),$("#b_sollkonto").selectmenu(),$("#b_habenkonto").selectmenu(),$("#b_sollkonto").selectmenu("refresh",!0),$("#b_habenkonto").selectmenu("refresh",!0)},e.openForEdit=function(n){e.selectedSchnellbuchung(n),jQuery.mobile.changePage("#schnellbuchung_bearbeiten"),$("#sb_sollkonto").selectmenu(),$("#sb_habenkonto").selectmenu(),$("#sb_sollkonto").selectmenu("refresh",!0),$("#sb_habenkonto").selectmenu("refresh",!0)},e.openNewForm=function(n){e.selectedSchnellbuchung(new hhb.model.types.Schnellbuchung),jQuery.mobile.changePage("#schnellbuchung_anlegen"),$("#sb_sollkonto").selectmenu(),$("#sb_habenkonto").selectmenu(),$("#sb_sollkonto").selectmenu("refresh",!0),$("#sb_habenkonto").selectmenu("refresh",!0)},e.speichern=function(){var n=e.selectedSchnellbuchung();doPOST("Menu","updateQuickMenu",ko.toJSON(n),function(n){jQuery.mobile.changePage("#schnellbuchungen_liste"),e.load()},function(e){util.showErrorMessage(e,"Fehler beim Speichern der Schnellbuchung aufgetreten")})},e.anlegen=function(){var n=e.selectedSchnellbuchung();doPOST("Menu","addQuickMenu",ko.toJSON(n),function(n){jQuery.mobile.changePage("#schnellbuchungen_liste"),e.load()},function(e){util.showErrorMessage(e,"Fehler beim Anlegen der Schnellbuchung aufgetreten")})},e.loeschen=function(){doGET("Menu","removeQuickMenu",{id:e.selectedSchnellbuchung().config_id()},function(n){jQuery.mobile.changePage("#schnellbuchungen_liste"),e.load()},function(e){util.showErrorMessage(e,"Fehler beim Löschen der Schnellbuchung aufgetreten")})},e.load=function(){e.schnellbuchungen.removeAll(),e.schnellbuchungen_navigation.removeAll(),doGETwithCache("Menu","getQuickMenu",[],function(n){for(var t=0;t<n.length;t++){var o=new hhb.model.types.Schnellbuchung(n[t]);e.schnellbuchungen.push(o),e.schnellbuchungen_navigation.push(new hhb.model.types.NavigationEntry({label:n[t].config_knz,target:"#buchungen_erfassen",data:o,callback:function(n){e.executeSchnellbuchung(n.data),jQuery.mobile.changePage(n.target())}}))}$("#h_navigation").listview(),$("#h_navigation").listview("refresh"),$("#s_liste").listview(),$("#s_liste").listview("refresh")},function(e){util.showErrorMessage(e,"Fehler beim Laden der Schnellbuchungen aufgetreten")})},e.load()},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.types.VerlaufEintragEinfach=function(e){var n=this;n.monat=ko.observable("000000"),n.betrag=ko.observable(0),e&&(n.monat(e.grouping),n.betrag(e.saldo))},hhb.model.types.VerlaufEintragMehrfach=function(e){var n=this;n.monat=ko.observable("000000"),n.betraege=ko.observableArray([0,0]),e&&(n.monat(e.tag),n.betraege.removeAll(),n.betraege.push(e.vormonat),n.betraege.push(e.aktuell))},hhb.model.types.VerlaufModel=function(){var e=this;e.titel=ko.observable(hhb.i18n.verlauf.verlaufsauswertung),e.selected_monat=ko.observable("000000"),e.sollhaben=ko.observable("H"),e.verlauf_einfach=ko.observableArray([]),e.verlauf_einfach.push(new hhb.model.types.VerlaufEintragEinfach),e.verlauf_mehrfach=ko.observableArray([]),e.verlauf_mehrfach.push(new hhb.model.types.VerlaufEintragMehrfach),e.konten_selectable=ko.observableArray([]),e.konten_selected=ko.observableArray([]),e.onchange=null,e.verlaufaufwand=function(){e.titel(hhb.i18n.verlauf.verlaufaufwand_title),e.verlauf_einfach.removeAll(),e.loadVerlaufEinfach("Result","getVerlauf",{id:3})},e.verlaufertrag=function(){e.titel(hhb.i18n.verlauf.verlaufertrag_title),e.verlauf_einfach.removeAll(),e.loadVerlaufEinfach("Result","getVerlauf",{id:4})},e.verlaufgewinn=function(){e.titel(hhb.i18n.verlauf.verlaufgewinn_title),e.verlauf_einfach.removeAll(),e.loadVerlaufEinfach("Result","getVerlaufGewinn",{})},e.verlaufintern=function(){e.titel(hhb.i18n.verlauf.monatsinternerverlauf_title),e.verlauf_mehrfach.removeAll(),e.loadVerlaufMehrfach("Progress","getIntraMonth",{month_id:e.selected_monat()}),e.onchange=e.verlaufintern},e.verlaufzuundabfluss=function(){e.titel(hhb.i18n.verlauf.zuundabfluss_title),jQuery.mobile.changePage("#verlauf_kontenliste")},e.showVerlaufzuundabfluss=function(n){e.verlauf_einfach.removeAll(),"S"==e.sollhaben()?e.titel(hhb.i18n.verlauf.zufluss+": "+n.kontonummer()):e.titel(hhb.i18n.verlauf.abfluss+": "+n.kontonummer()),e.loadVerlaufEinfach("Progress","getCashFlow",{id:n.kontonummer(),side:e.sollhaben()})},e.verlauffrei=function(){e.konten_selected.removeAll(),e.konten_selectable.removeAll(),hhb.model.MainModel.konten().refreshKonten(function(n){for(var t=0;t<n.konten().length;t++)e.konten_selectable.push(n.konten()[t]);jQuery.mobile.changePage("#verlauf_kontenauswahl"),$(".konten_liste2").listview(),$(".konten_liste2").listview("refresh")})},e.verlauffrei_select=function(n){0==e.konten_selected().length&&(e.konten_selected_type=e.getKontenFamily(n.kontenart_id())),e.konten_selected_type===e.getKontenFamily(n.kontenart_id())?(e.konten_selected.push(n),e.konten_selectable.remove(n),$(".konten_liste2").listview(),$(".konten_liste2").listview("refresh")):alert(hhb.i18n.verlauf.selektionsfehler)},e.verlauffrei_deselect=function(n){e.konten_selectable.push(n),e.konten_selected.remove(n),$(".konten_liste2").listview(),$(".konten_liste2").listview("refresh")},e.showVerlauffrei=function(){var n="",t=e.konten_selected().length;e.verlauf_einfach.removeAll();for(var o=0;o<t;o++)n+=e.konten_selected()[o].kontonummer(),o<t-1&&(n+=",");e.loadVerlaufEinfach("Progress","getMonatsSalden",{id:n})},e.loadVerlaufEinfach=function(n,t,o){doGETwithCache(n,t,o,function(n){var t=[];for(var o in n){var a=n[o];e.verlauf_einfach.push(new hhb.model.types.VerlaufEintragEinfach(a)),t.push(a.saldo),d.init("verlauf_einfach_grafik"),d.setToWindowWidth(),d.drawLineDiagramFor(t)}jQuery.mobile.changePage("#verlauf_einfach_view")},function(e){util.showErrorMessage(e)})},e.loadVerlaufMehrfach=function(n,t,o){doGETwithCache(n,t,o,function(n){var t=[];t[0]=[],t[1]=[];for(var o in n){var a=n[o];e.verlauf_mehrfach.push(new hhb.model.types.VerlaufEintragMehrfach(a)),t[0].push(a.vormonat),t[1].push(a.aktuell),d.init("verlauf_mehrfach_grafik"),d.setToWindowWidth(),d.drawMultiLineDiagramFor(t,!1)}jQuery.mobile.changePage("#verlauf_mehrfach_view")},function(e){util.showErrorMessage(e)})},e.getKontenFamily=function(e){return"1"===e||"2"===e?1:"3"===e||"4"===e?2:0}},(hhb=hhb||{}).model=hhb.model||{},hhb.model.types=hhb.model.types||{},hhb.model.MainModel=null,hhb.model.types.MainModel=function(){var e=this;e.i18n=hhb.i18n,0!=$("#login_user").length?e.login=ko.observable(new hhb.model.types.LoginModel):(e.kontenarten=ko.observableArray([]),hhb.model.types.Kontenart.load(e.kontenarten),e.navigation=ko.observable(new hhb.model.types.NavigationModel),e.buchen=ko.observable(new hhb.model.types.BuchungenModel),e.konten=ko.observable(new hhb.model.types.KontenModel),e.schnellbuchungen=ko.observable(new hhb.model.types.SchnellbuchungModel),e.ergebnis=ko.observable(new hhb.model.types.ErgebnisModel),e.verlauf=ko.observable(new hhb.model.types.VerlaufModel),e.exporte=ko.observable(new hhb.model.types.ExportModel),e.configuration=ko.observable(new hhb.model.types.ConfigurationModel),e.ergebnis().initialize())},$(document).ready(function(){hhb.model.MainModel=new hhb.model.types.MainModel,ko.applyBindings(hhb.model.MainModel),jQuery.mobile.changePage("#")}),$(document).bind("pageinit",function(){$.mobile.defaultPageTransition="none"});